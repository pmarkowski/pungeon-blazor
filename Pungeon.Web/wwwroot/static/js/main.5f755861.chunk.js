(this["webpackJsonppungeon-react-experiments"]=this["webpackJsonppungeon-react-experiments"]||[]).push([[0],{23:function(e,t,a){e.exports=a(45)},28:function(e,t,a){},29:function(e,t,a){},45:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(6),i=a.n(c),o=(a(28),a(29),a(16)),s=a(17),l=a(22),d=a(20),u=a(9),m=a(8),h=a(21),p=a(1),E=function(e){return{type:"SELECT_TOOL",selectedTool:e}},b=function(e,t){return{type:"MOVE_SELECTED_OBJECT",deltaX:e,deltaY:t}},v=function(e,t){return{type:"SET_SELECTED_OBJECT_POSITION",x:e,y:t}},y=function(e,t){return{type:"SET_SELECTED_OBJECT_SIZE",width:e,height:t}},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"MOUSE_DOWN":return Object(p.a)(Object(p.a)({},e),{},{mouseDown:!0,mouseStartX:t.x,mouseStartY:t.y});case"MOUSE_UP":return Object(p.a)(Object(p.a)({},e),{},{mouseDown:!1});case"MOVE_SELECTED_OBJECT":var a=e.dungeon.spaces.map((function(a){return a.id===e.selectedObject?Object(p.a)(Object(p.a)({},a),{},{position:{x:a.position.x+t.deltaX,y:a.position.y+t.deltaY}}):a}));return Object(p.a)(Object(p.a)({},e),{},{dungeon:Object(p.a)(Object(p.a)({},e.dungeon),{},{spaces:a})});case"SET_SELECTED_OBJECT_POSITION":var n=e.dungeon.spaces.map((function(a){return a.id===e.selectedObject?Object(p.a)(Object(p.a)({},a),{},{position:{x:t.x,y:t.y}}):a}));return Object(p.a)(Object(p.a)({},e),{},{dungeon:Object(p.a)(Object(p.a)({},e.dungeon),{},{spaces:n})});case"SET_SELECTED_OBJECT_SIZE":var r=e.dungeon.spaces.map((function(a){return a.id===e.selectedObject?Object(p.a)(Object(p.a)({},a),{},{size:{width:t.width,height:t.height}}):a}));return Object(p.a)(Object(p.a)({},e),{},{dungeon:Object(p.a)(Object(p.a)({},e.dungeon),{},{spaces:r})});case"ADD_SPACE":if("NewSpace"===e.selectedTool){var c=e.dungeon.spaces.slice();return c=[].concat(Object(h.a)(c),[t.newSpace]),Object(p.a)(Object(p.a)({},e),{},{dungeon:Object(p.a)(Object(p.a)({},e.dungeon),{},{spaces:c})})}return e;case"SELECT_TOOL":var i=e.selectedObject;return"Select"!==t.selectedTool&&(i=null),Object(p.a)(Object(p.a)({},e),{},{selectedTool:t.selectedTool,selectedObject:i});case"SELECT_OBJECT":return"Select"===e.selectedTool?Object(p.a)(Object(p.a)({},e),{},{selectedObject:t.objectId}):e;case"DELETE_OBJECT":var o=e.selectedObject;if(o){var s=e.dungeon.spaces.filter((function(e){return e.id!==o}));return Object(p.a)(Object(p.a)({},e),{},{selectedObject:null,dungeon:Object(p.a)(Object(p.a)({},e.dungeon),{},{spaces:s})})}return e;default:return e}},f=Object(m.b)(g,{mouseDown:!1,mouseStartX:0,mouseStartY:0,selectedTool:"NewSpace",dungeon:{size:{width:28,height:32},spaces:[{id:"01f998f7-3ad4-43c6-b498-3249ab470b05",position:{x:1,y:1},size:{width:5,height:5}},{id:"79178d8c-3a3e-42ee-b1ec-00dc37a045fc",position:{x:6,y:4},size:{width:7,height:9}},{id:"6ce25fdc-9fd4-46c0-a924-74f5f9174193",position:{x:15,y:15},size:{width:6,height:7}},{id:"e211fbd3-a817-47a5-bb47-481ba330e46d",position:{x:21,y:19},size:{width:4,height:9}}],walls:[{start:{x:1,y:1},end:{x:1,y:6}},{start:{x:6,y:6},end:{x:1,y:6}},{start:{x:6,y:13},end:{x:6,y:6}},{start:{x:13,y:13},end:{x:6,y:13}},{start:{x:13,y:4},end:{x:13,y:13}},{start:{x:6,y:4},end:{x:13,y:4}},{start:{x:6,y:1},end:{x:6,y:4}},{start:{x:1,y:1},end:{x:6,y:1}},{start:{x:15,y:15},end:{x:15,y:22}},{start:{x:21,y:22},end:{x:15,y:22}},{start:{x:21,y:15},end:{x:15,y:15}},{start:{x:21,y:19},end:{x:21,y:15}},{start:{x:25,y:19},end:{x:21,y:19}},{start:{x:21,y:22},end:{x:21,y:28}},{start:{x:21,y:28},end:{x:25,y:28}},{start:{x:25,y:19},end:{x:25,y:28}}]}},"undefined"!==typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()),O=a(47),x=function(e,t){switch(e.key){case"Delete":return t.dispatch({type:"DELETE_OBJECT"});case"ArrowLeft":return t.dispatch(b(-1,0));case"ArrowRight":return t.dispatch(b(1,0));case"ArrowDown":return t.dispatch(b(0,1));case"ArrowUp":return t.dispatch(b(0,-1));default:return}},w=function(e){Object(l.a)(a,e);var t=Object(d.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{style:{height:"85vh"},tabIndex:-1,ref:function(t){return e.canvasDiv=t}})}},{key:"componentDidMount",value:function(){var e=this,t=new u.a({backgroundColor:6250335,sharedLoader:!0,sharedTicker:!0,antialias:!0});this.app=t,this.canvasDiv.appendChild(t.view),this.app.resizeTo=this.canvasDiv,this.app.resize();var a=new u.b;a.zIndex=Number.MAX_SAFE_INTEGER,t.stage.sortableChildren=!0,t.stage.addChild(a);this.setupInteractions(t,70),t.ticker.add((function(n){var r=f.getState();a.clear(),e.drawSpaces(t.stage,r,70),e.drawWalls(a,r.dungeon.walls,70),e.drawGrid(a,r.dungeon.size.width,r.dungeon.size.height,70),t.renderer.plugins.interaction.mouseOverRenderer&&e.drawSelectedGridBox(t,r,70,a)}))}},{key:"setupInteractions",value:function(e,t){var a=this;this.canvasDiv.addEventListener("wheel",(function(t){var a=.1;t.wheelDeltaY<0&&(a*=-1);var n=Math.min(Math.max(e.stage.scale.x+a,.1),2);if(n!==e.stage.scale.x){e.stage.scale.set(n);var r=e.renderer.plugins.interaction.mouse.getLocalPosition(e.stage);e.stage.position.x-=r.x*a,e.stage.position.y-=r.y*a}})),this.canvasDiv.addEventListener("contextmenu",(function(e){e.preventDefault()})),this.canvasDiv.addEventListener("pointerdown",(function(){a.onMouseDown(e)})),this.canvasDiv.addEventListener("pointerup",(function(){a.onMouseUp(e,t)})),this.canvasDiv.addEventListener("pointermove",(function(t){2===t.buttons&&(e.stage.position.x+=t.movementX,e.stage.position.y+=t.movementY)})),this.canvasDiv.addEventListener("keydown",(function(e){x(e,f)}))}},{key:"onMouseDown",value:function(e){if(0===e.renderer.plugins.interaction.mouse.button){var t=e.renderer.plugins.interaction.mouse.getLocalPosition(e.stage);f.dispatch({type:"MOUSE_DOWN",x:t.x,y:t.y})}}},{key:"onMouseUp",value:function(e,t){if(0===e.renderer.plugins.interaction.mouse.button){var a=e.renderer.plugins.interaction.mouse.getLocalPosition(e.stage);f.dispatch({type:"MOUSE_UP"});var n=f.getState(),r=Math.floor(Math.min(n.mouseStartX,a.x)/t),c=Math.floor(Math.min(n.mouseStartY,a.y)/t),i=Math.ceil(Math.max(n.mouseStartX,a.x)/t),o=Math.ceil(Math.max(n.mouseStartY,a.y)/t);f.dispatch({type:"ADD_SPACE",newSpace:{id:Object(O.a)(),position:{x:r,y:c},size:{width:i-r,height:o-c}}})}}},{key:"drawSpaces",value:function(e,t,a){var n=t.dungeon.spaces.reduce((function(e,t){return e[t.id]=t,e}),{}),r=new Set(e.children.map((function(e){return e.id})));Object.keys(n).forEach((function(t){if(!r.has(t)){var a=new u.b;a.id=t,a.interactive=!0,a.mouseup=function(){f.dispatch({type:"SELECT_OBJECT",objectId:this.id})},e.addChild(a)}})),e.children.forEach((function(r){if(r.id){var c=n[r.id];c?(r.clear(),r.beginFill(14079445),r.drawRect(c.position.x*a,c.position.y*a,c.size.width*a,c.size.height*a),r.endFill(),t.selectedObject===r.id?r.tint=16777164:r.tint=16777215):e.removeChild(r)}}))}},{key:"drawWalls",value:function(e,t,a){e.beginFill(),t.forEach((function(t){e.beginFill(157414,1),e.lineStyle(10,157414,1,.5),e.moveTo(t.start.x*a,t.start.y*a),e.lineTo(t.end.x*a,t.end.y*a),e.lineStyle(),e.drawCircle(t.start.x*a,t.start.y*a,5),e.drawCircle(t.end.x*a,t.end.y*a,5),e.endFill()}))}},{key:"drawSelectedGridBox",value:function(e,t,a,n){var r,c,i,o,s=e.renderer.plugins.interaction.mouse.getLocalPosition(e.stage);if(t.mouseDown){var l=Math.min(t.mouseStartX,s.x),d=Math.min(t.mouseStartY,s.y),u=Math.max(t.mouseStartX,s.x),m=Math.max(t.mouseStartY,s.y);r=Math.floor(l/a)*a,c=Math.floor(d/a)*a,i=(u=Math.floor(u/a)*a+a)-r,o=(m=Math.floor(m/a)*a+a)-c}else r=Math.floor(s.x/a)*a,c=Math.floor(s.y/a)*a,i=a,o=a;n.beginFill(0,0),n.lineStyle(1,16776448),n.drawRect(r,c,i,o),n.endFill()}},{key:"drawGrid",value:function(e,t,a,n){e.lineStyle(1,4473924,1,.5);for(var r=0;r<t;r++)e.moveTo(r*n,0),e.lineTo(r*n,(a-1)*n);for(var c=0;c<a;c++)e.moveTo(0,c*n),e.lineTo((t-1)*n,c*n)}}]),a}(r.a.Component),S=a(4),j=function(e){var t=e.dispatch,a=e.selectedObjectId,n=e.selectedObject;return a?r.a.createElement(r.a.Fragment,null,n.position&&r.a.createElement("div",{className:"card bg-dark text-light border-secondary mb-3"},r.a.createElement("div",{className:"card-header border-secondary"},r.a.createElement("h5",null,"Position")),r.a.createElement("div",{className:"card-body"},r.a.createElement("div",{className:"form-group"},r.a.createElement("label",null,"X:",r.a.createElement("input",{className:"form-control bg-secondary text-light",type:"number",value:n.position.x,onChange:function(e){return t(v(parseInt(e.target.value),n.position.y))}})),r.a.createElement("label",null,"Y:",r.a.createElement("input",{className:"form-control bg-secondary text-light",type:"number",value:n.position.y,onChange:function(e){return t(v(n.position.x,parseInt(e.target.value)))}}))))),n.size&&r.a.createElement("div",{className:"card bg-dark text-light border-secondary mb-3"},r.a.createElement("div",{className:"card-header border-secondary"},r.a.createElement("h5",null,"Size")),r.a.createElement("div",{className:"card-body"},r.a.createElement("div",{className:"form-group"},r.a.createElement("label",null,"Width:",r.a.createElement("input",{className:"form-control bg-secondary text-light",type:"number",value:n.size.width,onChange:function(e){return t(y(parseInt(e.target.value),n.size.height))}})),r.a.createElement("label",null,"Height:",r.a.createElement("input",{className:"form-control bg-secondary text-light",type:"number",value:n.size.height,onChange:function(e){return t(y(n.size.width,parseInt(e.target.value)))}}))))),a&&r.a.createElement("div",{className:"card bg-dark text-light border-secondary mb-3"},r.a.createElement("div",{className:"card-header border-secondary"},r.a.createElement("h5",null,"Actions")),r.a.createElement("div",{className:"card-body"},r.a.createElement("button",{className:"btn btn-outline-danger",onClick:function(){return t({type:"DELETE_OBJECT"})}},"Delete Object")))):r.a.createElement("div",{className:"card bg-dark text-light border-secondary mb-3"},r.a.createElement("div",{className:"card-header border-secondary"},r.a.createElement("h5",null,"Instructions")),r.a.createElement("div",{className:"card-body"},r.a.createElement("p",null,r.a.createElement("i",null,"Right click")," to pan the view."),r.a.createElement("p",null,r.a.createElement("i",null,"Scroll")," to zoom in and out."),r.a.createElement("p",null,r.a.createElement("i",null,"Left click and drag")," to create new spaces with the New Space tool."),r.a.createElement("p",null,r.a.createElement("i",null,"Left click")," to select spaces with the Select tool."),r.a.createElement("p",null,r.a.createElement("i",null,"Arrow keys")," will move the currently selected space."),r.a.createElement("p",null,r.a.createElement("i",null,"Delete")," will delete the currently selected space.")))},T=j=Object(S.b)((function(e){return{selectedObjectId:e.selectedObject,selectedObject:e.dungeon.spaces.filter((function(t){return t.id===e.selectedObject}))[0]}}))(j),N=function(e){var t=e.dispatch,a=e.selectedTool;return r.a.createElement("div",{className:"btn-group",role:"group"},r.a.createElement("button",{className:"btn btn-secondary"+("Select"===a?" active":""),onClick:function(){return t(E("Select"))}},"Select"),r.a.createElement("button",{className:"btn btn-secondary"+("NewSpace"===a?" active":""),onClick:function(){return t(E("NewSpace"))}},"New Space"))},_=N=Object(S.b)((function(e){return{selectedTool:e.selectedTool}}))(N);var D=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("nav",{className:"navbar navbar-dark bg-secondary"},r.a.createElement("span",{className:"navbar-brand"},"Pungeon")),r.a.createElement("div",{className:"px-5"},r.a.createElement("div",{className:"py-2"},r.a.createElement(_,null)),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-9"},r.a.createElement(w,null)),r.a.createElement("div",{className:"col-md-3"},r.a.createElement(T,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(S.a,{store:f},r.a.createElement(D,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[23,1,2]]]);
//# sourceMappingURL=main.5f755861.chunk.js.map